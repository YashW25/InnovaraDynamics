{% extends "base.html" %}

{% block title %}Create Post - Admin{% endblock %}

{% block extra_head %}
<!-- SimpleMDE Markdown Editor -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
{% endblock %}

{% block content %}
<section class="admin-create-section py-5 mt-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h2 class="mb-4">Create New Blog Post</h2>

                        <form method="POST" action="{{ url_for('admin_create') }}">
                            <div class="mb-3">
                                <label for="title" class="form-label">Title *</label>
                                <input type="text" class="form-control" id="title" name="title" value="{{ title or '' }}" required autofocus>
                                <small class="form-text text-muted">The slug will be auto-generated from the title</small>
                            </div>

                            <div class="mb-3">
                                <label for="content" class="form-label">Content (Markdown) *</label>
                                <textarea class="form-control" id="content" name="content" rows="15" required>{{ content or '' }}</textarea>
                                <small class="form-text text-muted">You can use Markdown syntax for formatting</small>
                            </div>

                            <div class="d-flex justify-content-between">
                                <a href="{{ url_for('blog_list') }}" class="btn btn-secondary">Cancel</a>
                                <button type="submit" class="btn btn-primary">Publish Post</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
    var simplemde = new SimpleMDE({
        element: document.getElementById("content"),
        spellChecker: false,
        placeholder: "Write your blog post using Markdown...",
        autofocus: true,
        autosave: {
            enabled: false
        },
        forceSync: true,   // ðŸ”¥ THIS IS IMPORTANT
        toolbar: [
            "bold", "italic", "heading", "|",
            "quote", "unordered-list", "ordered-list", "|",
            "link", "image", "|", "preview", 
            "side-by-side", "fullscreen", "|", "guide"
        ]
    });

    // ðŸ”¥ Make sure content syncs before submitting the form
    document.querySelector("form").addEventListener("submit", function () {
        simplemde.codemirror.save();  // Ensures textarea gets editor content
    });
</script>

{% endblock %}